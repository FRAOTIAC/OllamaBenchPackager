# 车载语音助手 - 抗干扰测试用例

## 📋 测试目的

本测试旨在验证车载语音助手在面对复杂、带有干扰信息的输入时，能否准确识别和提取真正的车辆控制指令。

## 🎯 测试重点

- **指令提取能力** - 从复杂语境中提取核心指令
- **抗干扰能力** - 忽略无关信息，专注于车辆控制
- **意图识别精度** - 正确理解用户的真实意图
- **JSON输出稳定性** - 保持标准格式输出

## 🧪 测试用例

### 测试用例 1: 闲聊夹杂指令
**输入:**
```
"今天天气真好啊，阳光明媚的，不过车里有点闷，你说我们是不是应该把车窗打开透透气？对了，你知道今天股市怎么样吗？"
```

**预期输出:**
```json
{
  "u_message": "好的好的，车窗马上为您打开！让新鲜空气进来，这样就不会闷了～",
  "veh_object": "car_window",
  "veh_operation": "open"
}
```

**测试要点:**
- 忽略天气、股市等无关信息
- 正确识别"把车窗打开"的核心指令
- 理解"透气"的隐含需求

---

### 测试用例 2: 否定句干扰
**输入:**
```
"我不想开空调，也不想关灯，但是现在车里空气不太好，还是把车窗打开吧，不过等会儿到了目的地记得关上。"
```

**预期输出:**
```json
{
  "u_message": "明白了，车窗已经为您打开啦！空气马上就会变好的～",
  "veh_object": "car_window",
  "veh_operation": "open"
}
```

**测试要点:**
- 忽略否定句的干扰（不想开空调、不想关灯）
- 识别转折语句中的真实意图
- 专注于当前指令，忽略未来计划

---

### 测试用例 3: 多重条件混合
**输入:**
```
"如果外面没有下雨的话，而且风不是很大，温度也合适，那么我们就把车窗打开一点点，让新鲜空气进来，但是如果有灰尘就算了。"
```

**预期输出:**
```json
{
  "u_message": "好的好的，车窗为您打开了！让清新的空气流通起来～",
  "veh_object": "car_window", 
  "veh_operation": "open"
}
```

**测试要点:**
- 处理复杂条件句
- 识别主要意图（打开车窗）
- 忽略假设性条件

---

### 测试用例 4: 时间延迟指令
**输入:**
```
"等会儿到了红绿灯的时候，记得提醒我给老婆打个电话，还有就是趁这个时候把车窗打开通通风，因为刚才有人在车里抽烟。"
```

**预期输出:**
```json
{
  "u_message": "好的好的，车窗马上为您打开！马上就能通风换气啦～",
  "veh_object": "car_window",
  "veh_operation": "open"
}
```

**测试要点:**
- 忽略非车辆控制任务（打电话提醒）
- 提取车辆控制指令
- 理解"通通风"的表达

---

### 测试用例 5: 反向逻辑
**输入:**
```
"车窗关着的时候总觉得憋得慌，特别是夏天，所以我觉得不应该一直关着，你觉得呢？帮我把车窗打开好吗？"
```

**预期输出:**
```json
{
  "u_message": "当然可以！车窗为您打开了，这样就不会憋得慌啦～",
  "veh_object": "car_window",
  "veh_operation": "open"
}
```

**测试要点:**
- 处理反向逻辑表达
- 识别最终明确的请求
- 理解情感表达背后的需求

---

### 测试用例 6: 包含其他车辆功能
**输入:**
```
"现在车里温度还可以，空调也不用开，灯光也够亮，就是觉得有点闷，把车窗打开让空气流通一下，音响声音也不用调。"
```

**预期输出:**
```json
{
  "u_message": "好的好的，车窗为您打开了！让空气流通起来会更舒服～",
  "veh_object": "car_window",
  "veh_operation": "open"
}
```

**测试要点:**
- 区分需要执行和不需要执行的指令
- 准确识别核心需求
- 忽略否定性描述

---

### 测试用例 7: 情景描述
**输入:**
```
"刚才路过一个工地，车里进了好多灰尘，现在想开车窗吹吹风，但是又怕外面的空气质量不好，算了还是开一下吧，把车窗打开。"
```

**预期输出:**
```json
{
  "u_message": "明白了，车窗已经为您打开！吹吹风会感觉舒服很多～",
  "veh_object": "car_window",
  "veh_operation": "open"
}
```

**测试要点:**
- 理解用户的内心矛盾
- 识别最终决定
- 忽略情景描述，专注指令

---

### 测试用例 8: 询问式干扰
**输入:**
```
"你觉得现在这个天气适合开车窗吗？我觉得挺合适的，空气也不错，要不我们把车窗打开？你觉得呢？还是说开空调比较好？"
```

**预期输出:**
```json
{
  "u_message": "好的好的，车窗为您打开了！现在的天气确实很适合开车窗呢～",
  "veh_object": "car_window",
  "veh_operation": "open"
}
```

**测试要点:**
- 处理询问式表达
- 识别倾向性意图
- 忽略选择性困惑

---

## 🔍 额外测试用例 - 其他车辆功能

### 测试用例 9: 空调相关迷惑性输入
**输入:**
```
"外面太阳好大，车里感觉像蒸笼一样，我觉得不开空调肯定不行，你说对吧？赶紧把空调打开吧，不然要热死了。"
```

**预期输出:**
```json
{
  "u_message": "嗖——空调已经启动啦！凉风正往你这边吹呢，马上就凉快了～",
  "veh_object": "air_switch",
  "veh_operation": "open"
}
```

### 测试用例 10: 灯光相关迷惑性输入
**输入:**
```
"天色有点暗了，路上车也多，安全起见我觉得应该开灯，不过是开近光灯还是远光灯呢？算了，先开近光灯吧，毕竟市区里不能开远光。"
```

**预期输出:**
```json
{
  "u_message": "好的好的，近光灯已经为您打开了！这样开车会更安全～",
  "veh_object": "lbeam_control",
  "veh_operation": "open"
}
```

---

## 🎯 测试执行方法

### 方法 1: 命令行测试
```bash
# 使用 curl 测试
curl -X POST http://localhost:11434/api/generate \
  -H "Content-Type: application/json" \
  -d '{
    "model": "vehicle-assistant",
    "prompt": "测试输入内容",
    "stream": false
  }'
```

### 方法 2: 前端界面测试
使用 `车载语音助手前端示例.html` 进行交互式测试

### 方法 3: Python 脚本测试
```python
import requests
import json

def test_interference_resistance(test_input):
    response = requests.post('http://localhost:11434/api/generate', 
                           json={
                               'model': 'vehicle-assistant',
                               'prompt': test_input,
                               'stream': False
                           })
    
    if response.status_code == 200:
        result = response.json()
        try:
            parsed = json.loads(result['response'])
            return parsed
        except:
            return {"error": "JSON parsing failed", "raw": result['response']}
    return {"error": f"HTTP {response.status_code}"}

# 测试示例
test_cases = [
    "今天天气真好啊，阳光明媚的，不过车里有点闷，你说我们是不是应该把车窗打开透透气？",
    "我不想开空调，也不想关灯，但是现在车里空气不太好，还是把车窗打开吧。"
]

for i, test in enumerate(test_cases, 1):
    print(f"测试用例 {i}:")
    print(f"输入: {test}")
    result = test_interference_resistance(test)
    print(f"输出: {json.dumps(result, ensure_ascii=False, indent=2)}")
    print("-" * 50)
```

---

## 📊 测试评估标准

### 成功标准
- ✅ **指令识别正确** - 正确识别车辆控制指令
- ✅ **JSON格式完整** - 包含 u_message, veh_object, veh_operation
- ✅ **操作映射准确** - veh_object 和 veh_operation 匹配正确
- ✅ **响应自然** - u_message 回复自然友好

### 失败标准
- ❌ **指令丢失** - 未能识别出车辆控制指令
- ❌ **干扰误判** - 被无关信息干扰，执行错误操作
- ❌ **格式错误** - JSON 格式不正确或字段缺失
- ❌ **映射错误** - 功能对象和操作不匹配

---

## 🔧 优化建议

### 如果测试失败
1. **调整提示词** - 增强抗干扰能力的描述
2. **增加示例** - 在 Modelfile 中添加更多复杂场景示例
3. **参数调优** - 调整 temperature, top_p 等参数
4. **模型升级** - 考虑使用更大参数量的模型

### 持续改进
- 收集实际使用中的复杂输入
- 定期更新测试用例库
- 监控模型在复杂场景下的表现
- 根据用户反馈调整模型行为

---

**测试文档版本**: v1.0  
**创建时间**: 2025-01-17  
**适用模型**: vehicle-assistant (基于 qwen2.5:0.5b)  
**测试环境**: Ollama 本地部署 